// Translations
const translations = {
    en: {
        nav: {
            home: "Home",
            menu: "Menu",
            gallery: "Gallery",
            reservations: "Reservations",
            contact: "Contact"
        },
        hero: {
            title: "L'Olivar Vell",
            subtitle: "Authentic Mediterranean Cuisine in the Heart of Barcelona",
            cta: "Reserve a Table"
        },
        about: {
            title: "Welcome to L'Olivar Vell",
            text: "Nestled in the heart of Barcelona's Gothic Quarter, L'Olivar Vell offers an exquisite journey through Mediterranean flavors. Our chef combines traditional Catalan recipes with modern culinary techniques, creating unforgettable dining experiences since 1987."
        },
        menu: {
            title: "Our Menu",
            categories: {
                starters: "Starters",
                mains: "Main Courses",
                desserts: "Desserts"
            },
            items: {
                pan_con_tomate: {
                    name: "Pan con Tomate",
                    desc: "Traditional Catalan tomato bread with extra virgin olive oil and sea salt"
                },
                croquetas: {
                    name: "Croquetas de Jamón",
                    desc: "Creamy ham croquettes with béchamel sauce"
                },
                gambas: {
                    name: "Gambas al Ajillo",
                    desc: "Sizzling garlic prawns with white wine and chili"
                },
                pulpo: {
                    name: "Pulpo a la Gallega",
                    desc: "Galician-style octopus with paprika, olive oil, and boiled potatoes"
                },
                patatas: {
                    name: "Patatas Bravas",
                    desc: "Crispy fried potatoes with spicy bravas sauce and aioli"
                },
                pimientos: {
                    name: "Pimientos de Padrón",
                    desc: "Fried Padrón peppers with coarse sea salt"
                },
                jamon: {
                    name: "Jamón Ibérico",
                    desc: "Hand-carved Iberian ham with tomato and breadsticks"
                },
                ensalada: {
                    name: "Ensalada Mediterránea",
                    desc: "Mixed greens with cherry tomatoes, olives, feta cheese, and olive oil dressing"
                },
                paella: {
                    name: "Paella de Mariscos",
                    desc: "Traditional seafood paella with saffron rice, mussels, prawns, and squid"
                },
                bacalao: {
                    name: "Bacalao a la Catalana",
                    desc: "Cod fish with tomatoes, peppers, and olives in traditional Catalan style"
                },
                cordero: {
                    name: "Cordero Asado",
                    desc: "Slow-roasted lamb with rosemary, seasonal vegetables, and potato gratin"
                },
                risotto: {
                    name: "Risotto de Setas",
                    desc: "Creamy mushroom risotto with truffle oil and Parmesan"
                },
                lubina: {
                    name: "Lubina al Horno",
                    desc: "Oven-baked sea bass with lemon, herbs, and roasted vegetables"
                },
                solomillo: {
                    name: "Solomillo de Ternera",
                    desc: "Beef tenderloin with red wine reduction, foie gras, and grilled asparagus"
                },
                arroz_negro: {
                    name: "Arroz Negro",
                    desc: "Black rice with squid ink, calamari, and aioli"
                },
                fideuá: {
                    name: "Fideuá de Mariscos",
                    desc: "Seafood noodle paella with prawns, mussels, and squid"
                },
                cochinillo: {
                    name: "Cochinillo Asado",
                    desc: "Roasted suckling pig with crispy skin and apple compote"
                },
                crema_catalana: {
                    name: "Crema Catalana",
                    desc: "Classic Catalan custard with caramelized sugar crust"
                },
                tarta: {
                    name: "Tarta de Santiago",
                    desc: "Almond cake dusted with powdered sugar"
                },
                flan: {
                    name: "Flan de Huevo",
                    desc: "Smooth egg custard with caramel sauce"
                },
                churros: {
                    name: "Churros con Chocolate",
                    desc: "Traditional fried dough pastries with hot chocolate dipping sauce"
                },
                tarta_queso: {
                    name: "Tarta de Queso",
                    desc: "Basque-style burnt cheesecake with berry compote"
                },
                mel_mato: {
                    name: "Mel i Mató",
                    desc: "Fresh cheese with honey and walnuts, a Catalan classic"
                },
                tiramisu: {
                    name: "Tiramisú Mediterráneo",
                    desc: "Mediterranean twist on classic tiramisu with citrus notes"
                },
                torrijas: {
                    name: "Torrijas",
                    desc: "Spanish-style French toast with cinnamon and honey"
                }
            }
        },
        gallery: {
            title: "Our Ambience"
        },
        reviews: {
            title: "What Our Guests Say",
            review1: {
                text: "An absolutely wonderful dining experience! The paella was the best I've had in Barcelona. The atmosphere is elegant yet welcoming.",
                author: "- Emma Thompson, London"
            },
            review2: {
                text: "Exceptional service and incredible food. Every dish was beautifully presented and delicious. A must-visit when in Barcelona!",
                author: "- Marco Rossi, Milano"
            },
            review3: {
                text: "The perfect blend of traditional and contemporary cuisine. The lamb was cooked to perfection. Will definitely return!",
                author: "- Sophie Martin, Paris"
            }
        },
        reservations: {
            title: "Make a Reservation",
            form: {
                date: "Date",
                time: "Time",
                select_time: "Select a time",
                guests: "Number of Guests",
                select_guests: "Select number of guests",
                name: "Full Name",
                email: "Email",
                submit: "Reserve Now"
            },
            success: {
                title: "Your reservation has been made!",
                message: "We look forward to welcoming you to L'Olivar Vell.",
                another: "Make Another Reservation"
            }
        },
        contact: {
            hours: {
                title: "Opening Hours",
                monday_friday: "Monday - Friday",
                saturday: "Saturday",
                sunday: "Sunday"
            },
            info: {
                title: "Contact Information",
                address: "Address",
                phone: "Phone",
                email: "Email"
            },
            location: {
                title: "Find Us"
            }
        },
        footer: {
            tagline: "Authentic Mediterranean Cuisine Since 1987",
            rights: "All rights reserved."
        }
    },
    es: {
        nav: {
            home: "Inicio",
            menu: "Menú",
            gallery: "Galería",
            reservations: "Reservas",
            contact: "Contacto"
        },
        hero: {
            title: "L'Olivar Vell",
            subtitle: "Auténtica Cocina Mediterránea en el Corazón de Barcelona",
            cta: "Reservar Mesa"
        },
        about: {
            title: "Bienvenidos a L'Olivar Vell",
            text: "Ubicado en el corazón del Barrio Gótico de Barcelona, L'Olivar Vell ofrece un exquisito viaje a través de los sabores mediterráneos. Nuestro chef combina recetas tradicionales catalanas con técnicas culinarias modernas, creando experiencias gastronómicas inolvidables desde 1987."
        },
        menu: {
            title: "Nuestro Menú",
            categories: {
                starters: "Entrantes",
                mains: "Platos Principales",
                desserts: "Postres"
            },
            items: {
                pan_con_tomate: {
                    name: "Pan con Tomate",
                    desc: "Pan tradicional catalán con tomate, aceite de oliva virgen extra y sal marina"
                },
                croquetas: {
                    name: "Croquetas de Jamón",
                    desc: "Croquetas cremosas de jamón con salsa bechamel"
                },
                gambas: {
                    name: "Gambas al Ajillo",
                    desc: "Gambas al ajillo con vino blanco y guindilla"
                },
                pulpo: {
                    name: "Pulpo a la Gallega",
                    desc: "Pulpo estilo gallego con pimentón, aceite de oliva y patatas cocidas"
                },
                patatas: {
                    name: "Patatas Bravas",
                    desc: "Patatas fritas crujientes con salsa brava picante y alioli"
                },
                pimientos: {
                    name: "Pimientos de Padrón",
                    desc: "Pimientos de Padrón fritos con sal marina gruesa"
                },
                jamon: {
                    name: "Jamón Ibérico",
                    desc: "Jamón ibérico cortado a mano con tomate y picos"
                },
                ensalada: {
                    name: "Ensalada Mediterránea",
                    desc: "Mezcla de verduras con tomates cherry, aceitunas, queso feta y aliño de aceite de oliva"
                },
                paella: {
                    name: "Paella de Mariscos",
                    desc: "Paella tradicional de mariscos con arroz al azafrán, mejillones, gambas y calamares"
                },
                bacalao: {
                    name: "Bacalao a la Catalana",
                    desc: "Bacalao con tomates, pimientos y aceitunas al estilo tradicional catalán"
                },
                cordero: {
                    name: "Cordero Asado",
                    desc: "Cordero asado lentamente con romero, verduras de temporada y gratín de patatas"
                },
                risotto: {
                    name: "Risotto de Setas",
                    desc: "Risotto cremoso de setas con aceite de trufa y parmesano"
                },
                lubina: {
                    name: "Lubina al Horno",
                    desc: "Lubina al horno con limón, hierbas y verduras asadas"
                },
                solomillo: {
                    name: "Solomillo de Ternera",
                    desc: "Solomillo de ternera con reducción de vino tinto, foie gras y espárragos a la parrilla"
                },
                arroz_negro: {
                    name: "Arroz Negro",
                    desc: "Arroz negro con tinta de calamar, calamares y alioli"
                },
                fideuá: {
                    name: "Fideuá de Mariscos",
                    desc: "Fideuá de mariscos con gambas, mejillones y calamares"
                },
                cochinillo: {
                    name: "Cochinillo Asado",
                    desc: "Cochinillo asado con piel crujiente y compota de manzana"
                },
                crema_catalana: {
                    name: "Crema Catalana",
                    desc: "Clásica crema catalana con costra de azúcar caramelizado"
                },
                tarta: {
                    name: "Tarta de Santiago",
                    desc: "Tarta de almendras espolvoreada con azúcar glas"
                },
                flan: {
                    name: "Flan de Huevo",
                    desc: "Flan suave de huevo con salsa de caramelo"
                },
                churros: {
                    name: "Churros con Chocolate",
                    desc: "Churros tradicionales con salsa de chocolate caliente"
                },
                tarta_queso: {
                    name: "Tarta de Queso",
                    desc: "Tarta de queso estilo vasco con compota de frutos rojos"
                },
                mel_mato: {
                    name: "Mel i Mató",
                    desc: "Queso fresco con miel y nueces, un clásico catalán"
                },
                tiramisu: {
                    name: "Tiramisú Mediterráneo",
                    desc: "Tiramisú con un toque mediterráneo y notas cítricas"
                },
                torrijas: {
                    name: "Torrijas",
                    desc: "Torrijas al estilo español con canela y miel"
                }
            }
        },
        gallery: {
            title: "Nuestro Ambiente"
        },
        reviews: {
            title: "Lo Que Dicen Nuestros Clientes",
            review1: {
                text: "¡Una experiencia gastronómica absolutamente maravillosa! La paella fue la mejor que he probado en Barcelona. El ambiente es elegante y acogedor.",
                author: "- Emma Thompson, Londres"
            },
            review2: {
                text: "Servicio excepcional y comida increíble. Cada plato estaba bellamente presentado y delicioso. ¡Una visita obligada en Barcelona!",
                author: "- Marco Rossi, Milán"
            },
            review3: {
                text: "La combinación perfecta de cocina tradicional y contemporánea. El cordero estaba cocinado a la perfección. ¡Definitivamente volveré!",
                author: "- Sophie Martin, París"
            }
        },
        reservations: {
            title: "Hacer una Reserva",
            form: {
                date: "Fecha",
                time: "Hora",
                select_time: "Seleccione una hora",
                guests: "Número de Comensales",
                select_guests: "Seleccione número de comensales",
                name: "Nombre Completo",
                email: "Correo Electrónico",
                submit: "Reservar Ahora"
            },
            success: {
                title: "¡Su reserva ha sido realizada!",
                message: "Esperamos darle la bienvenida a L'Olivar Vell.",
                another: "Hacer Otra Reserva"
            }
        },
        contact: {
            hours: {
                title: "Horario de Apertura",
                monday_friday: "Lunes - Viernes",
                saturday: "Sábado",
                sunday: "Domingo"
            },
            info: {
                title: "Información de Contacto",
                address: "Dirección",
                phone: "Teléfono",
                email: "Correo"
            },
            location: {
                title: "Encuéntranos"
            }
        },
        footer: {
            tagline: "Auténtica Cocina Mediterránea Desde 1987",
            rights: "Todos los derechos reservados."
        }
    }
};

// Language switching
let currentLang = 'en';

// Make this function globally accessible for onclick handlers
window.switchLanguage = function(lang) {
    console.log('switchLanguage called with:', lang);
    setLanguage(lang);
};

function setLanguage(lang) {
    console.log('setLanguage called with:', lang);
    currentLang = lang;
    document.documentElement.lang = lang;

    // Update active language button
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
    });

    // Update all translatable elements
    let translatedCount = 0;
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const keys = element.dataset.i18n.split('.');
        let translation = translations[lang];

        try {
            for (const key of keys) {
                translation = translation[key];
                if (translation === undefined) {
                    console.warn(`Translation missing for: ${keys.join('.')} in ${lang}`);
                    return;
                }
            }
            element.textContent = translation;
            translatedCount++;
        } catch (error) {
            console.error(`Error translating ${keys.join('.')}: ${error}`);
        }
    });

    console.log(`Translated ${translatedCount} elements to ${lang}`);

    // Save preference
    try {
        localStorage.setItem('language', lang);
    } catch (e) {
        console.warn('Could not save language preference to localStorage:', e);
    }
}

// Initialize language
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM Content Loaded');

    const savedLang = localStorage.getItem('language') || 'en';
    setLanguage(savedLang);

    // Language switcher event listeners - using more direct approach
    const langButtons = document.querySelectorAll('.lang-btn');
    console.log('Found language buttons:', langButtons.length);

    langButtons.forEach((btn, index) => {
        console.log(`Button ${index}: data-lang="${btn.dataset.lang}"`);
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const targetLang = btn.dataset.lang;
            console.log('Language button clicked:', targetLang);
            setLanguage(targetLang);
        });
    });

    console.log('Language switcher initialized. Current language:', currentLang);

    // Mobile menu toggle
    const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    const navMenu = document.querySelector('.nav-menu');

    mobileMenuToggle.addEventListener('click', () => {
        navMenu.classList.toggle('active');
    });

    // Close mobile menu when clicking a link
    document.querySelectorAll('.nav-menu a').forEach(link => {
        link.addEventListener('click', () => {
            navMenu.classList.remove('active');
        });
    });

    // Smooth scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                const offset = 70; // Navbar height
                const targetPosition = target.offsetTop - offset;
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });

    // Menu category switching
    const menuCategoryBtns = document.querySelectorAll('.menu-category-btn');
    const menuItems = document.querySelectorAll('.menu-items');

    menuCategoryBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const category = btn.dataset.category;

            // Update active button
            menuCategoryBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // Show corresponding menu items
            menuItems.forEach(items => {
                if (items.dataset.category === category) {
                    items.classList.add('active');
                } else {
                    items.classList.remove('active');
                }
            });
        });
    });

    // Reservation form handling
    const reservationForm = document.getElementById('reservationForm');
    const reservationSuccess = document.getElementById('reservationSuccess');
    const makeAnotherBtn = document.getElementById('makeAnother');

    // Set minimum date to today
    const dateInput = document.getElementById('date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.setAttribute('min', today);

    reservationForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // Hide form and show success message
        reservationForm.style.display = 'none';
        reservationSuccess.classList.remove('hidden');

        // Scroll to success message
        reservationSuccess.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Reset form
        reservationForm.reset();
    });

    makeAnotherBtn.addEventListener('click', () => {
        reservationForm.style.display = 'block';
        reservationSuccess.classList.add('hidden');
        reservationForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    // Navbar scroll effect
    let lastScroll = 0;
    const navbar = document.querySelector('.navbar');

    window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;

        if (currentScroll <= 0) {
            navbar.style.transform = 'translateY(0)';
        } else if (currentScroll > lastScroll && currentScroll > 100) {
            // Scrolling down
            navbar.style.transform = 'translateY(-100%)';
        } else {
            // Scrolling up
            navbar.style.transform = 'translateY(0)';
        }

        lastScroll = currentScroll;
    });

    // Add animation on scroll for sections
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe sections for fade-in animation
    document.querySelectorAll('section').forEach(section => {
        section.style.opacity = '0';
        section.style.transform = 'translateY(20px)';
        section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(section);
    });
});

// Performance: Lazy load images (if needed in future)
if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                    imageObserver.unobserve(img);
                }
            }
        });
    });

    document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
    });
}
